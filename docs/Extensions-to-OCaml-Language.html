<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Extensions to OCaml Language | Why JavaScript?</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./Semantic-differences-from-other-backends.html" />
    
    
    <link rel="prev" href="./How-to-adapt-your-build-system.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="3.5"
        data-chapter-title="Extensions to OCaml Language"
        data-filepath="Extensions-to-OCaml-Language.md"
        data-basepath="."
        data-revision="Fri May 20 2016 13:10:16 GMT-0400 (EDT)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Home
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
                
                    <a target="_blank" href="https:/bloomberg.github.io/bucklescript/js-demo">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Playground
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Get Started</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Installation.html">
            
                
                    <a href="./Installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Installation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Create-a-simple-example-with-NPM.html">
            
                
                    <a href="./Create-a-simple-example-with-NPM.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Create a simple example with NPM
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="NPM-Support.html">
            
                
                    <a href="./NPM-Support.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        NPM Support
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> BuckleScript Basics</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="FAQ.html">
            
                
                    <a href="./FAQ.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        FAQ
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                
                    <a target="_blank" href="https:/ocaml.org/">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        About OCaml
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Compiler-options.html">
            
                
                    <a href="./Compiler-options.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Compiler options
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="How-to-adapt-your-build-system.html">
            
                
                    <a href="./How-to-adapt-your-build-system.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        How to adapt your build system
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.5" data-path="Extensions-to-OCaml-Language.html">
            
                
                    <a href="./Extensions-to-OCaml-Language.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Extensions to OCaml Language
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="Semantic-differences-from-other-backends.html">
            
                
                    <a href="./Semantic-differences-from-other-backends.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Semantic differences from other backends
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="JavaScript-target-versions.html">
            
                
                    <a href="./JavaScript-target-versions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        JavaScript target versions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> BuckleScript Overview</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Compiler-overview.html">
            
                
                    <a href="./Compiler-overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Compiler overview
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> BuckleScript FFI</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Runtime-representation.html">
            
                
                    <a href="./Runtime-representation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Runtime representation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="Curry-and-Uncurry-functions.html">
            
                
                    <a href="./Curry-and-Uncurry-functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Curry and Uncurry functions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="JS-call-OCaml.html">
            
                
                    <a href="./JS-call-OCaml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        JS call OCaml
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="OCaml-call-JS.html">
            
                
                    <a href="./OCaml-call-JS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        OCaml call JS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="Experimental-support-of-typescript.html">
            
                
                    <a href="./Experimental-support-of-typescript.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Experimental support of typescript
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="Unsupported-IO-primitives.html">
            
                
                    <a href="./Unsupported-IO-primitives.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Unsupported IO primitives
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Contributions</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" >
            
                
                    <a target="_blank" href="https:/github.com/bloomberg/bucklescript">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Github Link
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="Dev-mode-How-to.html">
            
                
                    <a href="./Dev-mode-How-to.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Dev mode How to
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="Help-move-runtime-functions-from-OCaml-to-Javascript.html">
            
                
                    <a href="./Help-move-runtime-functions-from-OCaml-to-Javascript.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Help move runtime functions from OCaml to Javascript
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> Roadmap</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Roadmap.html">
            
                
                    <a href="./Roadmap.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Roadmap
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> Comparisons</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="Differences-from-js_of_ocaml.html">
            
                
                    <a href="./Differences-from-js_of_ocaml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Differences from js_of_ocaml
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Why JavaScript?</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <p>BuckleScript leverages the OCaml support for extension with dedicated builtin extensions. Those BuckleScript extensions facilitates the integration of native JavaScript code as well as improve the generated code. </p>
<blockquote>
<p>Note that all those extension will be correctly ignored by the native OCaml compiler.</p>
</blockquote>
<ol>
<li><p>extension <code>bs.raw</code></p>
<p>It can be either <code>[%bs.raw{|  this_is_arbitrary_js_expression |}]</code> or <code>[%%bs.raw{| this is arbitrary_js_statement |}</code></p>
<p>Use cases:
for example if you want to use a JavaScript string, you can write code like this</p>
<pre><code class="lang-OCaml"><span class="hljs-keyword">let</span> x  : <span class="hljs-built_in">string</span> = [%bs.raw{|<span class="hljs-string">&quot;\x01\x02&quot;</span>|}]
</code></pre>
<p>which will be compiled into </p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> x = <span class="hljs-string">&quot;\x01\x02&quot;</span>
</code></pre>
<pre><code class="lang-OCaml">[%%bs.raw{|
// Math.imul polyfill
if (!Math.imul){
    Math.imul = function (..) {..}
 }
|}]
</code></pre>
<p>In the expression level, i.e, <code>[%js.raw ...]</code> user can add a type annotation, the compiler would use such type annotation to deduce its arities. for example, the next three versions:</p>
<pre><code class="lang-ocaml"><span class="hljs-keyword">let</span> f = [%bs.raw (<span class="hljs-string">&quot;Math.max&quot;</span>  : <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span>) ] <span class="hljs-number">3.0</span> 
<span class="hljs-keyword">let</span> f : <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span> = [%bs.raw <span class="hljs-string">&quot;Math.max&quot;</span> ] <span class="hljs-number">3.0</span>
<span class="hljs-keyword">let</span> f = ([%bs.raw <span class="hljs-string">&quot;Math.max&quot;</span>] : <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span> ) <span class="hljs-number">3.0</span>
</code></pre>
<p>will be translated into </p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params">prim</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">3.0</span>,prim);
}
</code></pre>
<p>Caveat:</p>
<ol>
<li>So far we don&apos;t do any sanity check in the quoted text (syntax check is a long-term goal)</li>
<li>You should not refer symbols in OCaml code, it is not guaranteed that the order is correct.
You should avoid introducing new symbols in the raw code, if needed, use the <code>$$</code> prefix (ie <code>$$your_func_name</code>) </li>
</ol>
</li>
<li><p>extension <code>bs.debugger</code></p>
<p>It can be <code>[%bs.debugger]</code></p>
<p>use case</p>
<pre><code class="lang-ocaml"><span class="hljs-keyword">let</span> f x y = 
   [%bs.debugger];
   x + y
</code></pre>
<p>which will be compiled into </p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span> (<span class="hljs-params">x,y</span>) </span>{
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// JavaScript developer tools will set an breakpoint and stop here</span>
  x + y;
}
</code></pre>
</li>
</ol>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./How-to-adapt-your-build-system.html" class="navigation navigation-prev " aria-label="Previous page: How to adapt your build system"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./Semantic-differences-from-other-backends.html" class="navigation navigation-next " aria-label="Next page: Semantic differences from other backends"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"edit-link":{"base":"https://github.com/bloomberg/bucklescript/tree/master/docs","label":"Edit This Page"},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
